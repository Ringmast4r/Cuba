function dyamar_poll_get_cookie(name){var cookies=document.cookie;if(cookies&&cookies.length>0)for(var items=cookies.split(";"),index=0;index<items.length;index++)if(items[index].length>0){var pair=items[index].trim();if(pair&&pair.length>0){var data=pair.split("=");if(data&&data.length>=2&&data[0]==name)return data[1]}}return""}function dyamar_poll_process_result(poll_id,answers){var index=0,total_votes=0;for(index=0;index<answers.length;++index)total_votes+=parseInt(answers[index].votes);for(index=0;index<answers.length;++index){var answer_id=answers[index].answer_id;if(answer_id>0){var percentage=0;total_votes>0&&(percentage=Math.round(parseFloat(answers[index].votes)/(total_votes/100)*100)/100);var poll_bar=jQuery("#dyamar_poll_"+poll_id+" #dyamar_poll_bar_"+answer_id);if(poll_bar&&poll_bar.length>0){var new_html="",votes=parseInt(answers[index].votes);new_html+=1==votes?'<div class="dyamar-poll-info">'+percentage+"%, "+votes+" vote</div>":'<div class="dyamar-poll-info">'+percentage+"%, "+votes+" votes</div>",new_html+=percentage<=0?'<div class="dyamar-poll-bar-bg" style="width:3px;"></div>':'<div class="dyamar-poll-bar-bg" style="width:'+percentage+'%;"></div>',poll_bar.html(new_html)}}}jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-total").text("Total votes: "+total_votes)}function dyamar_polls_send_vote(sender){var has_answer=!1,answer_ids=[],poll_id=0,lifetime=0,max_answers=0,admin_ajax="",poll_container=jQuery(sender).closest(".dyamar-poll-type-standard");if(poll_container.length>0){var poll_id_holder=poll_container.find('input[id^="dyamar_poll_id"]'),lifetime_holder=poll_container.find('input[id^="dyamar_poll_lifetime"]'),max_answers_holder=poll_container.find('input[id^="dyamar_poll_maxanswers"]'),admin_ajax_holder=poll_container.find('input[id^="dyamar_poll_adminajax"]');poll_id_holder.length>0&&(poll_id=poll_id_holder.val()),lifetime_holder.length>0&&(lifetime=lifetime_holder.val()),max_answers_holder.length>0&&(max_answers=max_answers_holder.val()),admin_ajax_holder.length>0&&(admin_ajax=admin_ajax_holder.val())}if(poll_id)if(jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-answers input").each(function(index){if(jQuery(this).prop("checked")){has_answer=!0;var elem_id=jQuery(this).attr("id");elem_id&&elem_id.length>0&&answer_ids.push(elem_id.replace("dyamar_poll_answer_",""))}}),has_answer){var data={action:"dyamar_polls_vote",dyamar_poll_id:poll_id,dyamar_poll_answer_ids:answer_ids};jQuery.post(admin_ajax,data,function(response){if(response){var result=jQuery.parseJSON(response);if(void 0!==result.status&&result.status.indexOf("success")>=0){alert("Your vote has been successfully accepted!");var answers=result.answers;if(answers instanceof Array&&dyamar_poll_process_result(poll_id,answers),lifetime>0){var currentDate=new Date;currentDate.setTime(currentDate.getTime()+1e3*lifetime);var expires="expires="+currentDate.toGMTString();document.cookie="DYAMAR_POLL_"+poll_id+"_VOTED=YES; "+expires+"; path=/",jQuery("#dyamar_poll_"+poll_id+"_view_question").hide(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-content").hide(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-result").show()}else jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-content").hide(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-result").show(),1==max_answers?poll_container.find('.dyamar-poll-content input[type="radio"]').prop("checked",!1):(poll_container.find('.dyamar-poll-content input[type="checkbox"]').prop("checked",!1),max_answers>1&&poll_container.find('.dyamar-poll-content input[type="checkbox"]').prop("disabled",!1))}else alert("Failed to save results. Server is not responding. Please try again later.")}})}else alert("Please select at least one answer!")}function dyamar_polls_view_result(sender){var poll_id=0,poll_container=jQuery(sender).closest(".dyamar-poll-type-standard");if(poll_container.length>0){var poll_id_holder=poll_container.find('input[id^="dyamar_poll_id"]');poll_id_holder.length>0&&(poll_id=poll_id_holder.val(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-content").hide(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-result").show())}return!1}function dyamar_polls_view_question(sender){var poll_id=0,poll_container=jQuery(sender).closest(".dyamar-poll-type-standard");if(poll_container.length>0){var poll_id_holder=poll_container.find('input[id^="dyamar_poll_id"]');poll_id_holder.length>0&&(poll_id=poll_id_holder.val(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-content").show(),jQuery("#dyamar_poll_"+poll_id+" .dyamar-poll-result").hide())}return!1}jQuery(document).ready(function($){if($(".dyamar-poll-type-standard").length){var request_ids=[],admin_ajax="";if($(".dyamar-poll-type-standard").each(function(index){var poll_id=0,poll_container=$(this);if(poll_container.length>0){var poll_id_holder=poll_container.find('input[id^="dyamar_poll_id"]');if(poll_id_holder.length>0&&(poll_id=poll_id_holder.val()),admin_ajax.length<=0){var admin_ajax_holder=poll_container.find('input[id^="dyamar_poll_adminajax"]');admin_ajax_holder.length>0&&(admin_ajax=admin_ajax_holder.val())}poll_id&&request_ids.push(poll_id)}}),request_ids&&request_ids.length>0){var data={action:"dyamar_polls_results",dyamar_poll_check_ids:request_ids};$.post(admin_ajax,data,function(response){if(response){var result=$.parseJSON(response);if(void 0!==result.status&&result.status.indexOf("success")>=0&&void 0!==result.polls&&result.polls instanceof Array)for(var index=0;index<result.polls.length;++index)if(void 0!==result.polls[index]){var target_poll_id=result.polls[index].poll_id,target_answers,lifetime=0,max_answers=0;dyamar_poll_process_result(target_poll_id,result.polls[index].answers);var poll_container=$("#dyamar_poll_"+target_poll_id+" .dyamar-poll-container");if(poll_container.length>0){var lifetime=0,max_answers=0,already_voted=!1,lifetime_holder=poll_container.find('input[id^="dyamar_poll_lifetime"]'),max_answers_holder=poll_container.find('input[id^="dyamar_poll_maxanswers"]');if(lifetime_holder.length>0&&(lifetime=lifetime_holder.val()),max_answers_holder.length>0&&(max_answers=max_answers_holder.val()),lifetime>0){var cookie_data=dyamar_poll_get_cookie("DYAMAR_POLL_"+target_poll_id+"_VOTED");cookie_data&&cookie_data.length>0&&"yes"==cookie_data.toLowerCase()&&(already_voted=!0)}already_voted?($("#dyamar_poll_"+target_poll_id+"_view_question").hide(),$("#dyamar_poll_"+target_poll_id+" .dyamar-poll-content").hide(),$("#dyamar_poll_"+target_poll_id+" .dyamar-poll-result").show()):($("#dyamar_poll_"+target_poll_id+"_view_question").show(),$("#dyamar_poll_"+target_poll_id+" .dyamar-poll-content").show(),$("#dyamar_poll_"+target_poll_id+" .dyamar-poll-result").hide()),1==max_answers?poll_container.find('.dyamar-poll-content input[type="radio"]').prop("checked",!1):(poll_container.find('.dyamar-poll-content input[type="checkbox"]').prop("checked",!1),max_answers>1&&poll_container.find('.dyamar-poll-content input[type="checkbox"]').prop("disabled",!1))}}}})}$('.dyamar-poll-type-standard .dyamar-poll-content input[type="checkbox"]').change(function(event){var max_answers=0,poll_container=$(this).closest(".dyamar-poll-type-standard");if(poll_container.length>0){var max_answers_holder=poll_container.find('input[id^="dyamar_poll_maxanswers"]');if(max_answers_holder.length>0&&(max_answers=max_answers_holder.val())>1){var voted_count=poll_container.find('.dyamar-poll-content input[type="checkbox"]:checked').length;poll_container.find('.dyamar-poll-content input[type="checkbox"]').removeAttr("disabled"),voted_count>=max_answers&&poll_container.find('.dyamar-poll-content input[type="checkbox"]:not(:checked)').prop("disabled",!0)}}})}});